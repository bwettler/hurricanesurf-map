<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>Hurricane Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css"/>
<style>
  html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    width: 100%;
  }
  #map {
    height: 100%;
    width: 100%;
  }
  /* Spin animation */
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  /* Use CSS transform functions that can combine with Leaflet's positioning */
  .leaflet-marker-icon[src*="hurricane.svg"] {
    animation: spin 2s linear infinite !important;
    transform-origin: 50% 50% !important;
  }
  /* Force animation on all hurricane images */
  img[src*="hurricane.svg"].leaflet-marker-icon {
    animation: spin 2s linear infinite !important;
    transform-origin: center !important;
  }
</style>
</head>
<body>
<div id="map"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>
  const ICON_SIZE = 64; // pixels
  const MAX_ZOOM = 8;
  const MIN_ZOOM = 3;
  
  // Use regular L.icon instead of divIcon
  const hurricaneIcon = L.icon({
    iconUrl: 'images/hurricane.svg',
    iconSize: [ICON_SIZE, ICON_SIZE],
    iconAnchor: [ICON_SIZE / 2, ICON_SIZE / 2],
    popupAnchor: [0, -ICON_SIZE / 2]
  });
  
  const map = L.map('map', {
    minZoom: MIN_ZOOM,
    maxZoom: MAX_ZOOM
  });
  
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors'
  }).addTo(map);
  
  fetch('surf-locations.json')
    .then(r => {
      if (!r.ok) throw new Error(`HTTP ${r.status}`);
      return r.json();
    })
    .then(data => {
      const markers = data.map(loc =>
        L.marker([loc.lat, loc.lng], { icon: hurricaneIcon })
          .bindPopup(
            `<strong>${loc.location}</strong><br>` +
            `${loc.hurricane} (${loc.year})<br>` +
            `${loc.surf || ''}<br>` +
            `${loc.notes || ''}<br>` +
            `<a href="${loc.link}" target="_blank">More info</a>`
          )
      );
      
      const group = L.featureGroup(markers).addTo(map);
      const bounds = group.getBounds();
      
      if (bounds.isValid()) {
        map.fitBounds(bounds, { padding: [20, 20], maxZoom: MAX_ZOOM });
      } else {
        map.setView([30, -80], 5);
      }
    })
    .catch(err => {
      console.error('Initialization error:', err);
      alert('Error initializing map assets.');
      map.setView([30, -80], 5);
    });
</script>
</body>
</html>
